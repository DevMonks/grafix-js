<!doctype html>
<html lang="en">
    <head>
        <title>Grafix.js - Demo</title>
        <link rel="stylesheet" href="css/bootstrap.min.css">
    </head>
    <body style="padding: 40px">

        <div>

            <div class="alert alert-info" style="margin-bottom: 40px">
                <strong>Debug Output:</strong>
                <pre id="debug"></pre>
            </div>

            <div class="well well-small">
                <canvas id="layer" width="700px" height="400px"></canvas>
            </div>

        </div>

        <script src="js/grafix.nocache.js"></script>
        <script>

            Grafix.import();

            var stage = new Stage( '#layer' );
            stage.color = Color.grey;

            var rect = new Rectangle( { width: 100, height: 100, color: Color.yellow } );
            stage.addChild( rect );

            var rect2 = new Rectangle( { width: 40, height: 40, color: Color.red } );
            rect.addChild( rect2 );
            rect.alignBy( stage );
            rect2.alignBy( rect );

            var frameCount = 0,
                wasEverInvalid = false,
                $debug = document.getElementById( 'debug' ),
                moveBack = false,
                moveDown = false;

            stage
                .update( function() {
                     if ( stage.invalid ) {
                         wasEverInvalid = true;
                     }
                     $debug.innerHTML =
                         'Stage.invalid: ' + stage.invalid + ' (was ever: ' + wasEverInvalid + ')<br>' +
                             'Frame Count: ' + ( ++frameCount ) + ', last Fps:' + stage._lastFps + '<br>' +
                             'scene: ' + stage + '<br>' +
                             'rect: ' + rect + ' (invalid:' + rect.invalid + ')<br>' +
                             'rect2: ' + rect2 + ' (invalid:' + rect2.invalid + ')<br>';

                     // Simple tween to test draw() delegation
                     // Every change to a shape should delegate up to the parent shape (Stage) and forcing a redraw
                     // of the most parent
                     if (!moveBack && (rect.x + 1 + rect.width) < stage.width) {
                        rect.x++;
                     } else {
                         moveBack = true;
                         if (rect.x > 0) {
                             rect.x--;
                         } else {
                             moveBack = false;
                         }
                     }

                     if (!moveDown && (rect.y + 1 + rect.height) < stage.height) {
                         rect.y++;
                     } else {
                         moveDown = true;
                         if (rect.y > 0) {
                             rect.y--;
                         } else {
                             moveDown = false;
                         }
                     }

                     rect2.alignBy(rect);
                 } )
                .start( true );

        </script>

    </body>
</html>
